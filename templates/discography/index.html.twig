{% extends 'base.html.twig' %}

{% block title %}{% trans %}Discography{% endtrans %}{% endblock %}

{% block body %}
    <div class="section has-text-white">
        <h1 class="title has-text-white">{% trans %}Discography{% endtrans %}</h1>
        <h2 class="subtitle has-text-white">{% trans %}Welcome to the discography page of the artist Marcel BOUNGOU{% endtrans %}</h2>
        <p>
            {% trans %}Find all the musical collections, from the great classics to the most recent productions, including the essentials{% endtrans %}
            <br>
            {% trans %}Filter your search by clicking on an Album or by using the search bar...{% endtrans %}
        </p>
        <input class="input mt-3" type="text" id="searchInput" onkeyup="searchFilter()" placeholder="{% trans %}Type a song here{% endtrans %}">
    </div>
    {{ include('discography/album_list.html.twig') }}
    {{ include('discography/musics_list.html.twig') }}
{% endblock %}

{% block javascripts %}


    <script>

        {#          BULMA CAROUSEL            #}
        //initialize options :

        var options = {
            initialSlide: 0,
            slidesToScroll: 1,
            slidesToShow: 5,
            infinite: false,
            loop:true,
            effect: 'translate',
            autoplay: false,
            navigationSwipe: true,
            navigationKeys: true,
            pagination: false,
        };

        // Initialize all div with carousel class
        var carousels = bulmaCarousel.attach('.carousel', options);

        // Loop on each carousel initialized
        for(var i = 0; i < carousels.length; i++) {
            // Add listener to  event
            carousels[i].on('before:show', state => {

            });
        }
        {#                               #}


        {# SCRIPT POUR LE BOUTON PLAY DES PLAYERS #}
        function startMusic(btn){
            let audio = btn.parentElement.querySelector('audio');
            if (!audio.paused){
                pauseAllMusics(audio);
            } else {
                pauseAllMusics(audio);
                audio.play();
            }
        }
        function pauseAllMusics(target){
            let allAudio = document.querySelectorAll('audio');
            allAudio.forEach(function (audio) {
                // if (target !== audio){
                audio.pause();
                // }
            });
        }

        let playBtns = document.querySelectorAll('.play-btn');
        playBtns.forEach(function (btn) {
            var audio = btn.parentElement.querySelector('audio');
            var icon = btn.parentElement.querySelector('i');
            var musicContainer = btn.parentElement.parentElement;
            var musicText = btn.parentElement.parentElement.querySelector('.music-text');
            audio.addEventListener('ended',function () {
                icon.classList.replace('fa-pause', 'fa-play');
                musicContainer.classList.remove('scalup-1-1');
                btn.parentElement.classList.remove('box-shadow-success');
                musicContainer.style.filter = 'grayscale(1)';
                musicText.classList.remove('text-shadow-success');
                if (musicContainer.nextElementSibling){
                    if (!musicContainer.nextElementSibling.classList.contains('is-hidden')) {
                        var nextBtnPlayAudio = musicContainer.nextElementSibling.querySelector('.play-btn');
                    }else {
                        var nextBtnPlayAudio = musicContainer.parentElement.firstElementChild.querySelector('.play-btn');
                    }
                }else {
                    if (!musicContainer.parentElement.firstElementChild.classList.contains('is-hidden')) {
                        console.log(musicContainer.parentElement.firstElementChild.classList.contains('is-hidden'));
                        var nextBtnPlayAudio = musicContainer.parentElement.firstElementChild.querySelector('.play-btn');
                    }
                }
                nextBtnPlayAudio.click();
            });
            audio.onpause = function () {
                icon.classList.replace('fa-pause', 'fa-play');
                musicContainer.classList.remove('scalup-1-1');
                btn.parentElement.classList.remove('box-shadow-success');
                musicContainer.style.filter = 'grayscale(1)';
                musicText.classList.remove('text-shadow-success')
            };
            audio.onplay = function () {
                icon.classList.replace('fa-play', 'fa-pause');
                musicContainer.classList.add('scalup-1-1');
                btn.parentElement.classList.add('box-shadow-success');
                musicContainer.style.filter = 'grayscale(0)';
                musicText.classList.add('text-shadow-success')
            };
        });
        {#                               #}

        {# POUR LES BOUTONS REPEAT #}
        let repeatBtns = document.querySelectorAll('.repeat-btn');
        repeatBtns.forEach(repeatMusic);
        function repeatMusic(btn) {
            var musicContainer = btn.parentElement.parentElement;
            var audio = musicContainer.querySelector('audio');
            btn.addEventListener('click',function () {
                audio.currentTime = 0;
            })
        }
        {#                               #}

        {#  FADE-OUT FADE-IN DISCS  #}
        let dics = document.querySelectorAll('.music-container');

        document.addEventListener('scroll', function () {
            dics.forEach(changeOpacityOnTopPosition);
            // showArrowUp();
        });

        window.onload = onLoad();
        function onLoad() {
            dics.forEach(changeOpacityOnTopPosition);
        }

        function changeOpacityOnTopPosition(element) {
            if ( 0 < element.getBoundingClientRect().top && element.getBoundingClientRect().top < 750 ){
                element.classList.replace('opacity0','opacity100');
            }else {
                element.classList.replace('opacity100','opacity0');
            }
        }
        {#                               #}


        {# SCRIPT POUR BARRE DE RECHERCHE FILTRE JS #}
        function searchFilter() {
            // Declare variables
            var input, filter, albumName, musicName, albumTxtValue, musicTxtValue, musicContainer;
            input = document.getElementById('searchInput');
            filter = input.value.toUpperCase();

            musicContainer = document.querySelectorAll('.music-container');

            // Loop through all list items, and hide those who don't match the search query
            musicContainer.forEach(function (container) {
                albumName = container.querySelector('.album-name');
                musicName = container.querySelector('.music-name');
                albumTxtValue = albumName.textContent || albumName.innerText;
                musicTxtValue = musicName.textContent || musicName.innerText;
                if ( (albumTxtValue.toUpperCase().indexOf(filter) > -1) || (musicTxtValue.toUpperCase().indexOf(filter) > -1) ) {
                    container.classList.remove('is-hidden');
                    container.classList.replace('opacity0', 'opacity100')
                } else {
                    container.classList.add('is-hidden');
                    container.classList.replace('opacity100', 'opacity0')
                }
            });
        }
        {#                               #}

        {# SCRIPT ANCRAGE ALBUM / MUSIQUES #}
        function searchAncrage(link) {
            var input = document.getElementById('searchInput');
            var ancrageTxt = link.getAttribute('data-href');
            input.value = ancrageTxt;
            searchFilter();
        }


    </script>


    {#          SCRIPT FOR JS DISC ANIMATION PERSO            #}
{#    <script>#}
{#        document.onload = initDiscs();#}
{#        let discs = document.querySelectorAll('.disc');#}

{#        discs.forEach(function (disc) {#}
{#            disc.addEventListener('click', function () {#}

{#                removeDiskClasses();#}

{#                giveNearAndFarDiscClasses(disc);#}

{#                initDiscs();#}

{#            })#}
{#        });#}

{#        function giveNearAndFarDiscClasses(thisDisc) {#}
{#            thisDisc.classList.add('disc-selected');#}
{#            let discNearLeft = thisDisc.previousElementSibling;#}
{#            if (discNearLeft){#}
{#                discNearLeft.classList.add('disc-near-left');#}
{#                let discFarLeft = discNearLeft.previousElementSibling;#}
{#                if (discFarLeft){#}
{#                    discFarLeft.classList.add('disc-far-left');#}
{#                }#}
{#            }#}
{#            let discNearRight = thisDisc.nextElementSibling;#}
{#            if (discNearRight){#}
{#                discNearRight.classList.add('disc-near-right');#}
{#                let discFarRight = discNearRight.nextElementSibling;#}
{#                if (discFarRight){#}
{#                    discFarRight.classList.add('disc-far-right');#}
{#                }#}
{#            }#}
{#        }#}

{#        function initDiscs(){#}
{#            let discs = document.querySelectorAll('.disc');#}
{#            discs.forEach(function (disc) {#}
{#                if (disc.classList.contains('disc-selected')){#}
{#                    disc.classList.remove('disc-hidden');#}
{#                    giveNearAndFarDiscClasses(disc);#}
{#                }else if(disc.classList.contains('disc-near-left') || disc.classList.contains('disc-near-right')){#}
{#                    disc.classList.remove('disc-hidden');#}
{#                }else if(disc.classList.contains('disc-far-left') || disc.classList.contains('disc-far-right')){#}
{#                    disc.classList.remove('disc-hidden');#}
{#                }else {#}
{#                    disc.classList.add('disc-hidden');#}
{#                }#}
{#            })#}
{#        }#}

{#        function showOrHideNearDisk(diskSelected) {#}
{#            let discNearLeft = diskSelected.previousElementSibling;#}
{#        }#}

{#        function removeDiskClasses() {#}
{#            let discs = document.querySelectorAll('.disc');#}
{#            discs.forEach(dsk => dsk.classList.remove("disc-selected", "disc-far-left", "disc-near-left", "disc-near-right", "disc-far-right"));#}
{#        }#}



{#        discs.forEach(function (disc) {#}
{#            var lastScrollTop = 0;#}
{#            if (disc){#}
{#                // element should be replaced with the actual target element on which you have applied scroll, use window in case of no target element.#}
{#                disc.addEventListener("scroll", function(){ // or window.addEventListener("scroll"....#}
{#                    var st = window.pageYOffset || document.documentElement.scrollTop; // Credits: "https://github.com/qeremy/so/blob/master/so.dom.js#L426"#}
{#                    if (st > lastScrollTop){#}
{#                        // downscroll code#}
{#                        // console.log('scroll down')#}
{#                    } else {#}
{#                        // upscroll code#}
{#                        // console.log('scroll up')#}
{#                    }#}
{#                    lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling#}
{#                }, false);#}
{#            }#}
{#        });#}

{#    </script>#}


{% endblock %}