{% extends 'base.html.twig' %}

{% block title %}{% trans %}Events{% endtrans %}{% endblock %}

{% block body %}
    <section class="container">
        <div class="is-flex-tablet is-flex-direction-row-reverse">
            <div class="column is-one-quarter-desktop is-one-third-tablet">
                {{ include('includes/calendar.html.twig') }}
            </div>
            <div class="column">
                <div class="box" style="height: 100%">
                    {{ events[0].title }}
                    -
                    {% if app.request.locale == 'fr' %}
                        {{ events[0].datetime|date('d/m/Y - H:i') }}
                    {% elseif app.request.locale == 'en' %}
                        {{ events[0].datetime|date('m/d/Y - h:i a') }}
                    {% else %}
                        {{ events[0].datetime|date('d/m/Y - H:i') }}
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="column">
            {% set count = 0 %}
            {% for event in events[1:] %}
                {% if count < 4 %}
                    <div class="box">
                        {{ event.title }}
                        -
                        {% if app.request.locale == 'fr' %}
                            {{ event.datetime|date('d/m/Y - H:i') }}
                        {% elseif app.request.locale == 'en' %}
                            {{ event.datetime|date('m/d/Y - h:i a') }}
                        {% else %}
                            {{ event.datetime|date('d/m/Y - H:i') }}
                        {% endif %}
                    </div>
                {% endif %}
                {% set count = count + 1 %}
            {% endfor %}
        </div>
    </section>
{% endblock %}


{% block javascripts %}
{#     BULMA CALENDAR     #}
<script>

var today  = new Date();
var yesterday = new Date();
yesterday.setDate(today.getDate() - 1);
var highlightsDates = [];

{% if events is defined %}
let date;
{% for event in events %}
date = '{{ event.datetime|date('d/m/Y') }}';
highlightsDates.push(date);
{% endfor %}
{% else %}
highlightsDates = false;
{% endif %}


//console.log(today.toLocaleDateString("fr-FR"));
//console.log(highlightsDates);

{% if app.request.get('_route') == 'events_new' %}
var defaultOptions = {
    type: 'datetime',
    displayMode: 'default',
    color: 'primary',
    showHeader: true,
    isRange: false,
    allowSameDayRange: true,
    lang: '{{ app.request.locale }}',
    startDate: today,
    endDate: undefined,
    minDate: undefined,
    maxDate: null,
    disabledDates: [],
    disabledWeekDays: undefined,
    highlightedDates: highlightsDates,
    weekStart: 0,
    dateFormat: 'dd/MM/yyyy',
    enableMonthSwitch: false,
    enableYearSwitch: false,
    displayYearsCount: 50,
    todayLabel: 'Aujourd\'hui',
    showClearButton: true,
    showButtons: true,
    showTodayButton: true,
};
{% else %}
var defaultOptions = {
    type: 'date',
    displayMode: 'inline',
    color: 'primary',
    showHeader: true,
    isRange: false,
    allowSameDayRange: true,
    lang: '{{ app.request.locale }}',
    startDate: today,
    endDate: undefined,
    minDate: today.toLocaleDateString('fr-FR'),
    maxDate: null,
    disabledDates: [],
    disabledWeekDays: undefined,
    highlightedDates: highlightsDates,
    weekStart: 0,
    dateFormat: 'dd/MM/yyyy',
    enableMonthSwitch: false,
    enableYearSwitch: false,
    displayYearsCount: 50,
    todayLabel: 'Aujourd\'hui',
    showClearButton: false,
    showButtons: false,
    showTodayButton: false,
};
{% endif %}

const calendars = bulmaCalendar.attach('[type="date"]', defaultOptions);

// Loop on each calendar initialized
calendars.forEach(calendar => {
    // Add listener to select event
    calendar.on('select', date => {
        // console.log(date);
    });
});

// To access to bulmaCalendar instance of an element

const agendas = document.querySelectorAll('.bulma-calendar');
agendas.forEach(function (agenda) {
    if (agenda) {
        // bulmaCalendar instance is available as element.bulmaCalendar
        agenda.bulmaCalendar.on('select', datepicker => {
            selectedDate = datepicker.data.value();
            let highlightsInfos = document.querySelectorAll('.highlight-info');
            highlightsInfos.forEach(highlight => highlight.classList.add('is-hidden'));
            //console.log(selectedDate);
            highlightsDates.forEach(function (highlight) {
                if (highlight === selectedDate){
                    let highlightInfoId = document.getElementById(highlight);
                    highlightInfoId.classList.remove('is-hidden');
                }
            });
        });
    }
});

</script>
{% endblock %}

